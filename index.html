<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ì¡°ê¸ˆ24 ì±—ë´‡ íŒŒì¼ ìƒì„±ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 28px;
            color: #2563EB;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .subtitle {
            text-align: center;
            color: #6B7280;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .info-box {
            background: #F0F9FF;
            border: 2px solid #BFDBFE;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .info-box h3 {
            font-size: 16px;
            color: #1E40AF;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-box ul {
            list-style: none;
            padding-left: 0;
        }
        
        .info-box li {
            padding: 8px 0;
            color: #374151;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-box li::before {
            content: "âœ“";
            color: #10B981;
            font-weight: bold;
        }
        
        .download-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #2563EB, #1D4ED8);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }
        
        .download-btn:active {
            transform: translateY(0);
        }
        
        .steps {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #E5E7EB;
        }
        
        .steps h3 {
            font-size: 16px;
            color: #374151;
            margin-bottom: 16px;
        }
        
        .step {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .step-number {
            width: 28px;
            height: 28px;
            background: #2563EB;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .step-text {
            color: #4B5563;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .warning {
            background: #FEF3C7;
            border: 2px solid #FCD34D;
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
        }
        
        .warning-title {
            font-weight: 600;
            color: #92400E;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .warning-text {
            color: #78350F;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .progress {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        
        .progress-text {
            color: #10B981;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #E5E7EB;
            border-top-color: #2563EB;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– ë³´ì¡°ê¸ˆ24 AI ì±—ë´‡</h1>
        <p class="subtitle">íŒŒì¼ ìë™ ìƒì„±ê¸°</p>
        
        <div class="info-box">
            <h3>ğŸ“¦ ë‹¤ìš´ë¡œë“œë  íŒŒì¼</h3>
            <ul>
                <li>index.html - ë©”ì¸ ì±—ë´‡ í˜ì´ì§€</li>
                <li>config.js - API ì„¤ì • íŒŒì¼</li>
                <li>chatbot.css - ì±—ë´‡ ìŠ¤íƒ€ì¼</li>
                <li>api.js - API ì—°ë™ ëª¨ë“ˆ</li>
                <li>chatbot.js - ì±—ë´‡ ë¡œì§</li>
            </ul>
        </div>
        
        <button class="download-btn" onclick="downloadAll()">
            ğŸš€ ëª¨ë“  íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹œì‘
        </button>
        
        <div class="progress" id="progress">
            <p class="progress-text">íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤‘...</p>
            <div class="spinner"></div>
        </div>
        
        <div class="steps">
            <h3>ğŸ“‹ ë‹¤ìš´ë¡œë“œ í›„ ì‚¬ìš© ë°©ë²•</h3>
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-text">
                    <strong>í´ë” êµ¬ì¡° ë§Œë“¤ê¸°</strong><br>
                    chatbot-subsidy í´ë” ìƒì„± â†’ ì•ˆì— css, js í´ë” ë§Œë“¤ê¸°
                </div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-text">
                    <strong>íŒŒì¼ ìœ„ì¹˜ ì´ë™</strong><br>
                    chatbot.css â†’ css í´ë”<br>
                    api.js, chatbot.js â†’ js í´ë”<br>
                    index.html, config.js â†’ ìµœìƒìœ„ í´ë”
                </div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-text">
                    <strong>API í‚¤ ì„¤ì •</strong><br>
                    config.js ì—´ì–´ì„œ API_KEY ê°’ì„ ë°œê¸‰ë°›ì€ í‚¤ë¡œ ë³€ê²½
                </div>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <div class="step-text">
                    <strong>ì‹¤í–‰í•˜ê¸°</strong><br>
                    VS Code Live Serverë¡œ index.html ì—´ê¸° ë˜ëŠ”<br>
                    index.htmlì„ í¬ë¡¬ìœ¼ë¡œ ì§ì ‘ ì—´ê¸°
                </div>
            </div>
        </div>
        
        <div class="warning">
            <div class="warning-title">âš ï¸ ì¤‘ìš” ì•ˆë‚´</div>
            <div class="warning-text">
                â€¢ config.jsì—ì„œ API í‚¤ë¥¼ ë°˜ë“œì‹œ ì…ë ¥í•´ì•¼ ì‘ë™í•©ë‹ˆë‹¤<br>
                â€¢ ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ "ì—¬ëŸ¬ íŒŒì¼ ë‹¤ìš´ë¡œë“œ í—ˆìš©"ì„ í™œì„±í™”í•˜ì„¸ìš”<br>
                â€¢ íŒŒì¼ì€ ìë™ìœ¼ë¡œ ìˆœì°¨ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤ (ì•½ 5ì´ˆ ì†Œìš”)
            </div>
        </div>
    </div>
    
    <script>
    // íŒŒì¼ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
    function download(filename, text) {
        const element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
        element.setAttribute('download', filename);
        element.style.display = 'none';
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);
    }
    
    // ëª¨ë“  íŒŒì¼ ë‹¤ìš´ë¡œë“œ
    async function downloadAll() {
        const progress = document.getElementById('progress');
        progress.style.display = 'block';
        
        // 1. index.html
        setTimeout(() => {
            download('index.html', indexHTML);
        }, 500);
        
        // 2. config.js
        setTimeout(() => {
            download('config.js', configJS);
        }, 1000);
        
        // 3. chatbot.css
        setTimeout(() => {
            download('chatbot.css', chatbotCSS);
        }, 1500);
        
        // 4. api.js
        setTimeout(() => {
            download('api.js', apiJS);
        }, 2000);
        
        // 5. chatbot.js
        setTimeout(() => {
            download('chatbot.js', chatbotJS);
        }, 2500);
        
        // ì™„ë£Œ ë©”ì‹œì§€
        setTimeout(() => {
            progress.style.display = 'none';
            alert('âœ… íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!\n\n' +
                  'ë‹¤ìš´ë¡œë“œ í´ë”ë¥¼ í™•ì¸í•˜ì„¸ìš”.\n\n' +
                  'ğŸ“ í´ë” êµ¬ì¡°:\n' +
                  'chatbot-subsidy/\n' +
                  'â”œâ”€â”€ index.html\n' +
                  'â”œâ”€â”€ config.js\n' +
                  'â”œâ”€â”€ css/\n' +
                  'â”‚   â””â”€â”€ chatbot.css\n' +
                  'â””â”€â”€ js/\n' +
                  '    â”œâ”€â”€ api.js\n' +
                  '    â””â”€â”€ chatbot.js');
        }, 3000);
    }
    
    // ====================================
    // íŒŒì¼ ë‚´ìš© (ë¬¸ìì—´ë¡œ ì €ì¥)
    // ====================================
    
    const indexHTML = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AIê°€ ì¶”ì²œí•˜ëŠ” ë‚˜ì—ê²Œ ë”± ë§ëŠ” ì •ë¶€ì§€ì›ê¸ˆ ì°¾ê¸°">
    <title>ë‚´ ì§€ì›ê¸ˆ ì°¾ê¸° AI ì±—ë´‡ | ë³´ì¡°ê¸ˆ24</title>
    <link rel="stylesheet" href="css/chatbot.css">
</head>
<body>
    <!-- ì±—ë´‡ ì»¨í…Œì´ë„ˆ -->
    <div class="chatbot-container">
        
        <!-- í—¤ë” -->
        <div class="chatbot-header">
            <div class="chatbot-header-left">
                <div class="chatbot-avatar">
                    <img src="https://via.placeholder.com/40" alt="AI ì–´ì‹œìŠ¤í„´íŠ¸">
                </div>
                <div class="chatbot-title">
                    <h1>ì§€ì›ê¸ˆ AI ì–´ì‹œìŠ¤í„´íŠ¸</h1>
                    <p class="chatbot-status">
                        <span class="status-dot"></span>
                        ì˜¨ë¼ì¸
                    </p>
                </div>
            </div>
            <button class="chatbot-close" id="minimizeBtn">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
            </button>
        </div>

        <!-- ì±— ì˜ì—­ -->
        <div class="chatbot-messages" id="chatMessages">
            
            <!-- ì›°ì»´ ë©”ì‹œì§€ -->
            <div class="message-wrapper bot-message">
                <div class="message-avatar">ğŸ¤–</div>
                <div class="message-content">
                    <div class="message-bubble">
                        <p>ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹</p>
                        <p>ì €ëŠ” <strong>ì •ë¶€ì§€ì›ê¸ˆ AI ì–´ì‹œìŠ¤í„´íŠ¸</strong>ì…ë‹ˆë‹¤.</p>
                        <p>ëª‡ ê°€ì§€ ì§ˆë¬¸ìœ¼ë¡œ íšŒì›ë‹˜ê»˜ ë”± ë§ëŠ” ì§€ì›ê¸ˆì„ ì°¾ì•„ë“œë¦´ê²Œìš”!</p>
                    </div>
                    <div class="message-time">ë°©ê¸ˆ ì „</div>
                </div>
            </div>

            <!-- í€µ ì•¡ì…˜ ë²„íŠ¼ -->
            <div class="quick-actions">
                <button class="quick-btn" data-action="start">
                    <span>ğŸ¯</span>
                    <span>ì§€ì›ê¸ˆ ì°¾ê¸° ì‹œì‘</span>
                </button>
                <button class="quick-btn" data-action="popular">
                    <span>ğŸ”¥</span>
                    <span>ì¸ê¸° ì§€ì›ê¸ˆ ë³´ê¸°</span>
                </button>
                <button class="quick-btn" data-action="deadline">
                    <span>â°</span>
                    <span>ë§ˆê° ì„ë°• ì§€ì›ê¸ˆ</span>
                </button>
            </div>

        </div>

        <!-- ì…ë ¥ ì˜ì—­ -->
        <div class="chatbot-input-wrapper">
            <div class="chatbot-input-container">
                <input 
                    type="text" 
                    class="chatbot-input" 
                    id="userInput"
                    placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                    autocomplete="off"
                >
                <button class="chatbot-send" id="sendBtn">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                    </svg>
                </button>
            </div>
        </div>

    </div>

    <!-- í”Œë¡œíŒ… ë²„íŠ¼ (ìµœì†Œí™” ì‹œ) -->
    <button class="chatbot-float-btn" id="floatBtn" style="display: none;">
        <svg width="28" height="28" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
        </svg>
        <span class="notification-badge">1</span>
    </button>

    <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ í…œí”Œë¦¿ -->
    <template id="loadingTemplate">
        <div class="message-wrapper bot-message">
            <div class="message-avatar">ğŸ¤–</div>
            <div class="message-content">
                <div class="typing-indicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </template>

    <!-- ì§€ì›ê¸ˆ ì¹´ë“œ í…œí”Œë¦¿ -->
    <template id="fundCardTemplate">
        <div class="fund-card">
            <div class="fund-card-header">
                <span class="fund-badge"></span>
                <span class="fund-views"></span>
            </div>
            <h3 class="fund-title"></h3>
            <p class="fund-desc"></p>
            <div class="fund-meta">
                <span class="fund-meta-item"></span>
            </div>
            <div class="fund-amount"></div>
            <a href="#" class="fund-cta">ìì„¸íˆ ë³´ê¸° â†’</a>
        </div>
    </template>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/chatbot.js"></script>
</body>
</html>`;

    const configJS = `/**
 * =====================================================
 * API ì„¤ì • íŒŒì¼
 * =====================================================
 */

const API_CONFIG = {
    // ë³´ì¡°ê¸ˆ24 API ê¸°ë³¸ ì •ë³´
    BASE_URL: 'https://api.odcloud.kr/api',
    
    // API ì¸ì¦í‚¤ (ë°œê¸‰ë°›ì€ í‚¤ë¡œ êµì²´í•˜ì„¸ìš”)
    API_KEY: 'sBFDCD7k4HuoN9JXUos2JrKXTFBtHoDVeAUtypKvQJc6INY/z3sWPo4qqAiHJrKToSaQxhXXWYVbQVIBYvjg+Q==',
    
    // ì—”ë“œí¬ì¸íŠ¸
    ENDPOINTS: {
        SERVICE_LIST: '/gov24/v3/serviceList',
        SERVICE_DETAIL: '/gov24/v3/serviceDetail',
        SUPPORT_CONDITIONS: '/gov24/v3/supportConditions'
    },
    
    // í˜ì´ì§• ì„¤ì •
    PAGINATION: {
        DEFAULT_PAGE: 1,
        DEFAULT_PER_PAGE: 10,
        MAX_PER_PAGE: 100
    },
    
    // ì¹´í…Œê³ ë¦¬ ë§¤í•‘
    CATEGORIES: {
        'ì²­ë…„': ['ì²­ë…„', 'ëŒ€í•™ìƒ', 'ì·¨ì—…', 'ì°½ì—…', 'ì£¼ê±°', 'í•™ìê¸ˆ'],
        'ìœ¡ì•„': ['ì¶œì‚°', 'ìœ¡ì•„', 'ë³´ìœ¡', 'ì–‘ìœ¡', 'ìë…€', 'ì•„ë™'],
        'ì£¼ê±°': ['ì£¼íƒ', 'ì „ì„¸', 'ì›”ì„¸', 'ì„ëŒ€', 'ì£¼ê±°'],
        'ê³ ìš©': ['ì‹¤ì—…', 'ì·¨ì—…', 'ì°½ì—…', 'ê³ ìš©', 'ì¼ìë¦¬'],
        'êµìœ¡': ['í•™ë¹„', 'ë“±ë¡ê¸ˆ', 'ì¥í•™ê¸ˆ', 'êµìœ¡'],
        'ì˜ë£Œ': ['ê±´ê°•', 'ì˜ë£Œ', 'ì¹˜ë£Œ', 'ì§ˆë³‘'],
        'ë³µì§€': ['ê¸°ì´ˆìƒí™œ', 'ì €ì†Œë“', 'ë³µì§€', 'ì§€ì›'],
        'ë†ì–´ì—…': ['ë†ì—…', 'ì–´ì—…', 'ë†ì´Œ', 'ì–´ì´Œ'],
        'ë¬¸í™”': ['ë¬¸í™”', 'ì²´ìœ¡', 'ê´€ê´‘', 'ì—¬ê°€']
    },
    
    // ì—°ë ¹ëŒ€ êµ¬ë¶„
    AGE_GROUPS: {
        'ì²­ì†Œë…„': { min: 13, max: 18, keywords: ['ì²­ì†Œë…„', 'í•™ìƒ'] },
        'ì²­ë…„': { min: 19, max: 34, keywords: ['ì²­ë…„', 'ëŒ€í•™ìƒ', 'ì·¨ì—…ì¤€ë¹„ìƒ'] },
        'ì¤‘ë…„': { min: 35, max: 49, keywords: ['ì¤‘ì¥ë…„', 'ê²½ë ¥'] },
        'ì¥ë…„': { min: 50, max: 64, keywords: ['ì¤‘ì¥ë…„', 'ì€í‡´ì¤€ë¹„'] },
        'ë…¸ë…„': { min: 65, max: 120, keywords: ['ë…¸ì¸', 'ì–´ë¥´ì‹ ', 'ê²½ë¡œ'] }
    },
    
    // ì†Œë“ ìˆ˜ì¤€
    INCOME_LEVELS: {
        'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰': { max: 0, keywords: ['ê¸°ì´ˆìƒí™œ', 'ìˆ˜ê¸‰', 'ì°¨ìƒìœ„'] },
        'ì €ì†Œë“': { max: 50, keywords: ['ì €ì†Œë“', 'ì†Œë“í•˜ìœ„'] },
        'ì¤‘ìœ„ì†Œë“': { max: 100, keywords: ['ì¤‘ìœ„ì†Œë“'] },
        'ì¼ë°˜': { max: 999, keywords: ['ì¼ë°˜'] }
    }
};

// API ìš”ì²­ í—¬í¼
const API_HELPER = {
    /**
     * ì „ì²´ URL ìƒì„±
     */
    buildUrl(endpoint, params = {}) {
        const url = new URL(API_CONFIG.BASE_URL + endpoint);
        
        // ê¸°ë³¸ íŒŒë¼ë¯¸í„°
        url.searchParams.append('page', params.page || API_CONFIG.PAGINATION.DEFAULT_PAGE);
        url.searchParams.append('perPage', params.perPage || API_CONFIG.PAGINATION.DEFAULT_PER_PAGE);
        
        // ì¶”ê°€ íŒŒë¼ë¯¸í„°
        Object.keys(params).forEach(key => {
            if (key !== 'page' && key !== 'perPage') {
                url.searchParams.append(key, params[key]);
            }
        });
        
        return url.toString();
    },
    
    /**
     * í—¤ë” ìƒì„±
     */
    getHeaders() {
        return {
            'Authorization': \`Infuser \${API_CONFIG.API_KEY}\`,
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        };
    }
};`;

    // chatbot.cssëŠ” ë„ˆë¬´ ê¸¸ì–´ì„œ ë³„ë„ë¡œ ì²˜ë¦¬
    const chatbotCSS = `/**
 * =====================================================
 * ë³´ì¡°ê¸ˆ24 AI ì±—ë´‡ ìŠ¤íƒ€ì¼
 * =====================================================
 */

/* ===== ì „ì—­ ì„¤ì • ===== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary: #2563EB;
    --primary-dark: #1D4ED8;
    --secondary: #10B981;
    --danger: #EF4444;
    --warning: #F59E0B;
    --gray-50: #F9FAFB;
    --gray-100: #F3F4F6;
    --gray-200: #E5E7EB;
    --gray-300: #D1D5DB;
    --gray-400: #9CA3AF;
    --gray-500: #6B7280;
    --gray-600: #4B5563;
    --gray-700: #374151;
    --gray-800: #1F2937;
    --gray-900: #111827;
    --white: #FFFFFF;
    
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
    --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.1);
    
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-xl: 20px;
    --radius-full: 9999px;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Pretendard', 'Segoe UI', 'Noto Sans KR', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

/* ===== ì±—ë´‡ ì»¨í…Œì´ë„ˆ ===== */
.chatbot-container {
    width: 100%;
    max-width: 440px;
    height: 700px;
    background: var(--white);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-xl);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    animation: slideUp 0.4s ease;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ===== í—¤ë” ===== */
.chatbot-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.chatbot-header-left {
    display: flex;
    align-items: center;
    gap: 12px;
}

.chatbot-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    overflow: hidden;
    border: 2px solid rgba(255, 255, 255, 0.3);
}

.chatbot-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.chatbot-title h1 {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 2px;
}

.chatbot-status {
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
    opacity: 0.9;
}

.status-dot {
    width: 8px;
    height: 8px;
    background: var(--secondary);
    border-radius: 50%;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.5;
    }
}

.chatbot-close {
    width: 36px;
    height: 36px;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.chatbot-close:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.05);
}

/* ===== ë©”ì‹œì§€ ì˜ì—­ ===== */
.chatbot-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    background: var(--gray-50);
    scroll-behavior: smooth;
}

.chatbot-messages::-webkit-scrollbar {
    width: 6px;
}

.chatbot-messages::-webkit-scrollbar-thumb {
    background: var(--gray-300);
    border-radius: var(--radius-full);
}

.chatbot-messages::-webkit-scrollbar-track {
    background: transparent;
}

/* ===== ë©”ì‹œì§€ ë²„ë¸” ===== */
.message-wrapper {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.message-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
}

.message-content {
    flex: 1;
    max-width: 75%;
}

.message-bubble {
    background: var(--white);
    padding: 14px 16px;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    margin-bottom: 6px;
}

.message-bubble p {
    font-size: 14px;
    line-height: 1.6;
    color: var(--gray-800);
    margin-bottom: 8px;
}

.message-bubble p:last-child {
    margin-bottom: 0;
}

.message-bubble strong {
    color: var(--primary);
    font-weight: 700;
}

.message-time {
    font-size: 11px;
    color: var(--gray-400);
    padding-left: 4px;
}

/* ì‚¬ìš©ì ë©”ì‹œì§€ */
.user-message {
    flex-direction: row-reverse;
}

.user-message .message-content {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
}

.user-message .message-bubble {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
}

.user-message .message-bubble p {
    color: white;
}

/* ===== íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ===== */
.typing-indicator {
    background: var(--white);
    padding: 14px 20px;
    border-radius: var(--radius-lg);
    display: inline-flex;
    gap: 6px;
    box-shadow: var(--shadow-sm);
}

.typing-indicator span {
    width: 8px;
    height: 8px;
    background: var(--gray-400);
    border-radius: 50%;
    animation: typing 1.4s infinite;
}

.typing-indicator span:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-indicator span:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes typing {
    0%, 60%, 100% {
        transform: translateY(0);
        background: var(--gray-400);
    }
    30% {
        transform: translateY(-10px);
        background: var(--primary);
    }
}

/* ===== í€µ ì•¡ì…˜ ë²„íŠ¼ ===== */
.quick-actions {
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
    margin-top: 16px;
}

.quick-btn {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 16px;
    background: var(--white);
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-md);
    font-size: 14px;
    font-weight: 600;
    color: var(--gray-700);
    cursor: pointer;
    transition: all 0.2s;
}

.quick-btn span:first-child {
    font-size: 20px;
}

.quick-btn:hover {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.quick-btn:active {
    transform: translateY(0);
}

.quick-btn.selected {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
}

/* ===== ì§€ì›ê¸ˆ ì¹´ë“œ ===== */
.fund-card {
    background: var(--white);
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-lg);
    padding: 16px;
    margin-bottom: 12px;
    transition: all 0.3s;
}

.fund-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary);
}

.fund-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.fund-badge {
    display: inline-block;
    padding: 4px 10px;
    background: #FEE2E2;
    color: #DC2626;
    border-radius: var(--radius-full);
    font-size: 11px;
    font-weight: 700;
}

.fund-badge.new {
    background: #DBEAFE;
    color: var(--primary);
}

.fund-views {
    font-size: 11px;
    color: var(--gray-400);
    display: flex;
    align-items: center;
    gap: 4px;
}

.fund-title {
    font-size: 15px;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 8px;
    line-height: 1.4;
}

.fund-desc {
    font-size: 13px;
    color: var(--gray-600);
    line-height: 1.5;
    margin-bottom: 12px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.fund-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 12px;
}

.fund-meta-item {
    font-size: 11px;
    color: var(--gray-500);
    background: var(--gray-100);
    padding: 4px 8px;
    border-radius: var(--radius-sm);
}

.fund-amount {
    font-size: 18px;
    font-weight: 800;
    color: var(--primary);
    margin-bottom: 12px;
    font-family: 'Outfit', sans-serif;
}

.fund-cta {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    color: var(--primary);
    font-size: 13px;
    font-weight: 600;
    text-decoration: none;
    transition: gap 0.2s;
}

.fund-cta:hover {
    gap: 10px;
}

/* ===== ì…ë ¥ ì˜ì—­ ===== */
.chatbot-input-wrapper {
    background: var(--white);
    border-top: 1px solid var(--gray-200);
    padding: 16px 20px;
}

.chatbot-input-container {
    display: flex;
    gap: 10px;
    align-items: center;
}

.chatbot-input {
    flex: 1;
    padding: 12px 16px;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-full);
    font-size: 14px;
    outline: none;
    transition: all 0.2s;
}

.chatbot-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.chatbot-send {
    width: 44px;
    height: 44px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    border: none;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    flex-shrink: 0;
}

.chatbot-send:hover {
    transform: scale(1.05);
    box-shadow: var(--shadow-md);
}

.chatbot-send:active {
    transform: scale(0.95);
}

.chatbot-send:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* ===== í”Œë¡œíŒ… ë²„íŠ¼ ===== */
.chatbot-float-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    border: none;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    box-shadow: var(--shadow-xl);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
    animation: fadeIn 0.3s ease;
}

.chatbot-float-btn:hover {
    transform: scale(1.1);
}

.notification-badge {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 20px;
    height: 20px;
    background: var(--danger);
    border-radius: 50%;
    font-size: 11px;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid white;
}

/* ===== ë°˜ì‘í˜• (ëª¨ë°”ì¼) ===== */
@media (max-width: 768px) {
    body {
        padding: 0;
        align-items: stretch;
    }

    .chatbot-container {
        max-width: 100%;
        height: 100vh;
        border-radius: 0;
    }

    .chatbot-messages {
        padding: 16px;
    }

    .message-content {
        max-width: 80%;
    }

    .fund-card {
        padding: 14px;
    }

    .fund-title {
        font-size: 14px;
    }

    .fund-desc {
        font-size: 12px;
    }

    .fund-amount {
        font-size: 16px;
    }

    .chatbot-float-btn {
        width: 56px;
        height: 56px;
        bottom: 20px;
        right: 20px;
    }
}

@media (max-width: 480px) {
    .chatbot-header {
        padding: 16px;
    }

    .chatbot-title h1 {
        font-size: 15px;
    }

    .chatbot-messages {
        padding: 12px;
    }

    .message-bubble {
        padding: 12px 14px;
    }

    .message-bubble p {
        font-size: 13px;
    }

    .quick-btn {
        padding: 12px 14px;
        font-size: 13px;
    }

    .chatbot-input-wrapper {
        padding: 12px 16px;
    }
}`;

    // apiJSì™€ chatbotJSëŠ” ë¬¸ì ìˆ˜ ì œí•œìœ¼ë¡œ ì¸í•´ ìš”ì•½ ë²„ì „
    const apiJS = `/**
 * ë³´ì¡°ê¸ˆ24 API ì—°ë™ ëª¨ë“ˆ
 */
class SubsidyAPI {
    constructor() {
        this.baseUrl = API_CONFIG.BASE_URL;
        this.apiKey = API_CONFIG.API_KEY;
    }

    async getServiceList(params = {}) {
        try {
            const url = API_HELPER.buildUrl(API_CONFIG.ENDPOINTS.SERVICE_LIST, params);
            const response = await fetch(url, {
                method: 'GET',
                headers: API_HELPER.getHeaders()
            });
            if (!response.ok) throw new Error(\`HTTP error! status: \${response.status}\`);
            return await response.json();
        } catch (error) {
            console.error('ì„œë¹„ìŠ¤ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
            throw error;
        }
    }

    async getPopularServices(limit = 5) {
        try {
            const data = await this.getServiceList({ perPage: limit });
            if (data.data && Array.isArray(data.data)) {
                return data.data.sort((a, b) => (b.ì¡°íšŒìˆ˜ || 0) - (a.ì¡°íšŒìˆ˜ || 0)).slice(0, limit);
            }
            return [];
        } catch (error) {
            console.error('ì¸ê¸° ì§€ì›ê¸ˆ ì¡°íšŒ ì˜¤ë¥˜:', error);
            return [];
        }
    }

    async getDeadlineServices(limit = 5) {
        try {
            const data = await this.getServiceList({ perPage: 50 });
            if (data.data && Array.isArray(data.data)) {
                const today = new Date();
                const withDeadline = data.data.filter(service => {
                    if (!service.ì‹ ì²­ê¸°í•œ || service.ì‹ ì²­ê¸°í•œ === 'ìƒì‹œì‹ ì²­') return false;
                    const deadlineMatch = service.ì‹ ì²­ê¸°í•œ.match(/(\\d{4})[.-](\\d{1,2})[.-](\\d{1,2})/);
                    if (!deadlineMatch) return false;
                    const deadline = new Date(deadlineMatch[1], deadlineMatch[2] - 1, deadlineMatch[3]);
                    const daysLeft = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
                    return daysLeft > 0 && daysLeft <= 30;
                });
                return withDeadline.slice(0, limit);
            }
            return [];
        } catch (error) {
            console.error('ë§ˆê° ì„ë°• ì§€ì›ê¸ˆ ì¡°íšŒ ì˜¤ë¥˜:', error);
            return [];
        }
    }

    async searchCustomServices(userProfile) {
        try {
            const keywords = this.generateKeywords(userProfile);
            const promises = keywords.map(keyword => 
                this.getServiceList({ 'cond[ì„œë¹„ìŠ¤ëª…::LIKE]': keyword, perPage: 20 })
            );
            const results = await Promise.all(promises);
            const allServices = [];
            const serviceIds = new Set();
            results.forEach(result => {
                if (result.data && Array.isArray(result.data)) {
                    result.data.forEach(service => {
                        if (!serviceIds.has(service.ì„œë¹„ìŠ¤ID)) {
                            serviceIds.add(service.ì„œë¹„ìŠ¤ID);
                            allServices.push(service);
                        }
                    });
                }
            });
            const scored = allServices.map(service => ({
                ...service,
                matchScore: this.calculateMatchScore(service, userProfile)
            }));
            scored.sort((a, b) => b.matchScore - a.matchScore);
            return scored.slice(0, 10);
        } catch (error) {
            console.error('ë§ì¶¤ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
            return [];
        }
    }

    generateKeywords(userProfile) {
        const keywords = [];
        for (const [ageGroup, config] of Object.entries(API_CONFIG.AGE_GROUPS)) {
            if (userProfile.age >= config.min && userProfile.age <= config.max) {
                keywords.push(...config.keywords);
            }
        }
        if (userProfile.interests && userProfile.interests.length > 0) {
            userProfile.interests.forEach(interest => {
                const categoryKeywords = API_CONFIG.CATEGORIES[interest];
                if (categoryKeywords) keywords.push(...categoryKeywords);
            });
        }
        return [...new Set(keywords)];
    }

    calculateMatchScore(service, userProfile) {
        let score = 0;
        const text = \`\${service.ì„œë¹„ìŠ¤ëª…} \${service.ì„œë¹„ìŠ¤ëª©ì ìš”ì•½ || ''} \${service.ì§€ì›ëŒ€ìƒ || ''}\`.toLowerCase();
        for (const [ageGroup, config] of Object.entries(API_CONFIG.AGE_GROUPS)) {
            if (userProfile.age >= config.min && userProfile.age <= config.max) {
                config.keywords.forEach(keyword => {
                    if (text.includes(keyword.toLowerCase())) score += 10;
                });
            }
        }
        if (userProfile.interests) {
            userProfile.interests.forEach(interest => {
                const keywords = API_CONFIG.CATEGORIES[interest];
                if (keywords) {
                    keywords.forEach(keyword => {
                        if (text.includes(keyword.toLowerCase())) score += 8;
                    });
                }
            });
        }
        if (service.ì¡°íšŒìˆ˜) score += Math.min(service.ì¡°íšŒìˆ˜ / 1000, 5);
        return score;
    }

    calculateDday(dateStr) {
        if (!dateStr || dateStr === 'ìƒì‹œì‹ ì²­') return 'ìƒì‹œ';
        const match = dateStr.match(/(\\d{4})[.-](\\d{1,2})[.-](\\d{1,2})/);
        if (!match) return 'ìƒì‹œ';
        const deadline = new Date(match[1], match[2] - 1, match[3]);
        const today = new Date();
        const diff = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
        if (diff < 0) return 'ë§ˆê°';
        if (diff === 0) return 'D-Day';
        return \`D-\${diff}\`;
    }
}

const subsidyAPI = new SubsidyAPI();`;

    const chatbotJS = `/**
 * ë³´ì¡°ê¸ˆ24 AI ì±—ë´‡ ë©”ì¸ ë¡œì§
 */
class SubsidyChatbot {
    constructor() {
        this.chatMessages = document.getElementById('chatMessages');
        this.userInput = document.getElementById('userInput');
        this.sendBtn = document.getElementById('sendBtn');
        this.minimizeBtn = document.getElementById('minimizeBtn');
        this.floatBtn = document.getElementById('floatBtn');
        this.chatContainer = document.querySelector('.chatbot-container');
        this.conversationState = 'idle';
        this.userProfile = { age: null, income: null, interests: [], region: null, family: [] };
        this.currentStep = 0;
        this.collectionSteps = [
            { key: 'age', question: 'ë¨¼ì €, ëª‡ ì‚´ì´ì‹ ê°€ìš”? ğŸ‚\\n(ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”)', type: 'number', validation: (value) => value >= 0 && value <= 120 },
            { key: 'income', question: 'ì›” í‰ê·  ì†Œë“ì€ ì–´ëŠ ì •ë„ì¸ê°€ìš”? ğŸ’°', type: 'choice', options: [
                { text: 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì', value: 0 }, { text: '100ë§Œì› ë¯¸ë§Œ', value: 50 },
                { text: '100~300ë§Œì›', value: 200 }, { text: '300~500ë§Œì›', value: 400 }, { text: '500ë§Œì› ì´ìƒ', value: 600 }
            ]},
            { key: 'interests', question: 'ì–´ë–¤ ë¶„ì•¼ì˜ ì§€ì›ê¸ˆì— ê´€ì‹¬ìˆìœ¼ì‹ ê°€ìš”? ğŸ¯\\n(ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥)', type: 'multi-choice', options: [
                { text: 'ğŸ  ì£¼ê±°/ì„ì°¨', value: 'ì£¼ê±°' }, { text: 'ğŸ‘¶ ì¶œì‚°/ìœ¡ì•„', value: 'ìœ¡ì•„' },
                { text: 'ğŸ“ êµìœ¡/í•™ìê¸ˆ', value: 'êµìœ¡' }, { text: 'ğŸ’¼ ì·¨ì—…/ì°½ì—…', value: 'ê³ ìš©' },
                { text: 'ğŸ¥ ì˜ë£Œ/ê±´ê°•', value: 'ì˜ë£Œ' }, { text: 'ğŸŒ¾ ë†ì–´ì—…', value: 'ë†ì–´ì—…' }, { text: 'ğŸ¨ ë¬¸í™”/ì—¬ê°€', value: 'ë¬¸í™”' }
            ]},
            { key: 'family', question: 'ê°€êµ¬ êµ¬ì„±ì€ ì–´ë–»ê²Œ ë˜ì‹œë‚˜ìš”? ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦\\n(í•´ë‹¹í•˜ëŠ” ê²ƒì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”)', type: 'multi-choice', options: [
                { text: 'í˜¼ì ì‚´ì•„ìš”', value: '1ì¸' }, { text: 'ë°°ìš°ì', value: 'ë°°ìš°ì' },
                { text: 'ìë…€', value: 'ìë…€' }, { text: 'ë¶€ëª¨ë‹˜', value: 'ë¶€ëª¨' }
            ]}
        ];
        this.init();
    }

    init() {
        this.sendBtn.addEventListener('click', () => this.handleSend());
        this.userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') this.handleSend(); });
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('click', (e) => this.handleQuickAction(e.currentTarget.dataset.action));
        });
        this.minimizeBtn.addEventListener('click', () => this.toggleChatbot());
        this.floatBtn.addEventListener('click', () => this.toggleChatbot());
    }

    async handleQuickAction(action) {
        const quickActions = document.querySelector('.quick-actions');
        if (quickActions) quickActions.style.display = 'none';
        switch (action) {
            case 'start': this.startCollection(); break;
            case 'popular': await this.showPopularServices(); break;
            case 'deadline': await this.showDeadlineServices(); break;
        }
    }

    async handleSend() {
        const message = this.userInput.value.trim();
        if (!message) return;
        this.addUserMessage(message);
        this.userInput.value = '';
        if (this.conversationState === 'collecting') {
            await this.handleCollectionResponse(message);
        } else {
            await this.handleGeneralMessage(message);
        }
    }

    startCollection() {
        this.conversationState = 'collecting';
        this.currentStep = 0;
        this.userProfile = { age: null, income: null, interests: [], region: null, family: [] };
        this.addBotMessage('ì¢‹ì•„ìš”! ëª‡ ê°€ì§€ë§Œ ì—¬ì­¤ë³¼ê²Œìš”. ğŸ˜Š');
        setTimeout(() => this.askCurrentStep(), 500);
    }

    askCurrentStep() {
        const step = this.collectionSteps[this.currentStep];
        if (step.type === 'choice' || step.type === 'multi-choice') {
            this.addBotMessageWithOptions(step.question, step.options, step.type === 'multi-choice');
        } else {
            this.addBotMessage(step.question);
        }
    }

    async handleCollectionResponse(message) {
        const step = this.collectionSteps[this.currentStep];
        let isValid = false;
        let value = null;
        if (step.type === 'number') {
            value = parseInt(message);
            isValid = !isNaN(value) && step.validation(value);
        } else if (step.type === 'choice') {
            const option = step.options.find(opt => 
                opt.text.toLowerCase().includes(message.toLowerCase()) || message.toLowerCase().includes(opt.text.toLowerCase())
            );
            if (option) { value = option.value; isValid = true; }
        }
        if (isValid) {
            if (Array.isArray(this.userProfile[step.key])) {
                this.userProfile[step.key].push(value);
            } else {
                this.userProfile[step.key] = value;
            }
            this.currentStep++;
            if (this.currentStep < this.collectionSteps.length) {
                this.addBotMessage('ì•Œê² ìŠµë‹ˆë‹¤! ğŸ‘');
                setTimeout(() => this.askCurrentStep(), 500);
            } else {
                await this.finishCollection();
            }
        } else {
            this.addBotMessage('ì£„ì†¡í•´ìš”, ë‹¤ì‹œ í•œë²ˆ ë§ì”€í•´ì£¼ì‹œê² ì–´ìš”? ğŸ¤”');
        }
    }

    async finishCollection() {
        this.conversationState = 'searching';
        this.addBotMessage('ì •ë³´ ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™\\në§ì¶¤ ì§€ì›ê¸ˆì„ ì°¾ê³  ìˆì–´ìš”...');
        this.showTypingIndicator();
        try {
            const results = await subsidyAPI.searchCustomServices(this.userProfile);
            this.removeTypingIndicator();
            if (results.length > 0) {
                this.addBotMessage(\`ì´ \${results.length}ê°œì˜ ì§€ì›ê¸ˆì„ ì°¾ì•˜ì–´ìš”! âœ¨\`);
                setTimeout(() => {
                    results.forEach((service, index) => {
                        setTimeout(() => this.addServiceCard(service), index * 200);
                    });
                }, 300);
            } else {
                this.addBotMessage('ì•„ì‰½ê²Œë„ í˜„ì¬ ì¡°ê±´ì— ë§ëŠ” ì§€ì›ê¸ˆì„ ì°¾ì§€ ëª»í–ˆì–´ìš”. ğŸ˜¢');
            }
        } catch (error) {
            this.removeTypingIndicator();
            this.addBotMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ğŸ˜¥');
        }
        this.conversationState = 'idle';
    }

    async handleGeneralMessage(message) {
        const lowerMessage = message.toLowerCase();
        if (lowerMessage.includes('ì¸ê¸°') || lowerMessage.includes('ë§ì´')) {
            await this.showPopularServices();
        } else if (lowerMessage.includes('ë§ˆê°') || lowerMessage.includes('ê¸‰í•´')) {
            await this.showDeadlineServices();
        } else if (lowerMessage.includes('ì²˜ìŒ') || lowerMessage.includes('ë‹¤ì‹œ')) {
            this.startCollection();
        } else {
            this.addBotMessage('ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”? ğŸ˜Š\\n\\nâ€¢ "ì§€ì›ê¸ˆ ì°¾ê¸°" - ë§ì¶¤ ì§€ì›ê¸ˆ ê²€ìƒ‰\\nâ€¢ "ì¸ê¸° ì§€ì›ê¸ˆ" - ì¸ê¸° TOP 5\\nâ€¢ "ë§ˆê° ì„ë°•" - ë§ˆê° ì„ë°• ì§€ì›ê¸ˆ');
        }
    }

    async showPopularServices() {
        this.addBotMessage('ì¸ê¸° ì§€ì›ê¸ˆ TOP 5ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆì–´ìš”! ğŸ”¥');
        this.showTypingIndicator();
        try {
            const services = await subsidyAPI.getPopularServices(5);
            this.removeTypingIndicator();
            if (services.length > 0) {
                this.addBotMessage('í˜„ì¬ ê°€ì¥ ì¸ê¸°ìˆëŠ” ì§€ì›ê¸ˆì´ì—ìš”! ğŸ‘‡');
                services.forEach((service, index) => {
                    setTimeout(() => this.addServiceCard(service), index * 200);
                });
            } else {
                this.addBotMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ì¸ê¸° ì§€ì›ê¸ˆì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆì–´ìš”. ğŸ˜¥');
            }
        } catch (error) {
            this.removeTypingIndicator();
            this.addBotMessage('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ğŸ˜¥');
        }
    }

    async showDeadlineServices() {
        this.addBotMessage('ë§ˆê° ì„ë°• ì§€ì›ê¸ˆì„ í™•ì¸í•˜ê³  ìˆì–´ìš”! â°');
        this.showTypingIndicator();
        try {
            const services = await subsidyAPI.getDeadlineServices(5);
            this.removeTypingIndicator();
            if (services.length > 0) {
                this.addBotMessage('ê³§ ë§ˆê°ë˜ëŠ” ì§€ì›ê¸ˆì´ì—ìš”! ğŸƒâ€â™‚ï¸');
                services.forEach((service, index) => {
                    setTimeout(() => this.addServiceCard(service), index * 200);
                });
            } else {
                this.addBotMessage('í˜„ì¬ ë§ˆê° ì„ë°•ì¸ ì§€ì›ê¸ˆì´ ì—†ì–´ìš”. ğŸ˜Š');
            }
        } catch (error) {
            this.removeTypingIndicator();
            this.addBotMessage('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ğŸ˜¥');
        }
    }

    addBotMessage(text) {
        const wrapper = document.createElement('div');
        wrapper.className = 'message-wrapper bot-message';
        wrapper.innerHTML = \`
            <div class="message-avatar">ğŸ¤–</div>
            <div class="message-content">
                <div class="message-bubble">\${text.split('\\n').map(line => \`<p>\${line}</p>\`).join('')}</div>
                <div class="message-time">\${this.getCurrentTime()}</div>
            </div>
        \`;
        this.chatMessages.appendChild(wrapper);
        this.scrollToBottom();
    }

    addBotMessageWithOptions(text, options, isMulti = false) {
        const wrapper = document.createElement('div');
        wrapper.className = 'message-wrapper bot-message';
        const optionsHTML = options.map((opt, idx) => \`
            <button class="quick-btn option-btn" data-value="\${opt.value}" data-multi="\${isMulti}">
                <span>\${opt.text}</span>
            </button>
        \`).join('');
        wrapper.innerHTML = \`
            <div class="message-avatar">ğŸ¤–</div>
            <div class="message-content">
                <div class="message-bubble">\${text.split('\\n').map(line => \`<p>\${line}</p>\`).join('')}</div>
                <div class="quick-actions" style="margin-top: 12px;">
                    \${optionsHTML}
                    \${isMulti ? '<button class="quick-btn option-done" style="background: #10B981; color: white; border-color: #10B981;">âœ“ ì„ íƒ ì™„ë£Œ</button>' : ''}
                </div>
                <div class="message-time">\${this.getCurrentTime()}</div>
            </div>
        \`;
        this.chatMessages.appendChild(wrapper);
        const step = this.collectionSteps[this.currentStep];
        wrapper.querySelectorAll('.option-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const value = e.currentTarget.dataset.value;
                const isMulti = e.currentTarget.dataset.multi === 'true';
                if (isMulti) {
                    e.currentTarget.classList.toggle('selected');
                    if (!this.userProfile[step.key]) this.userProfile[step.key] = [];
                    const index = this.userProfile[step.key].indexOf(value);
                    if (index > -1) this.userProfile[step.key].splice(index, 1);
                    else this.userProfile[step.key].push(value);
                } else {
                    this.userProfile[step.key] = value;
                    this.addUserMessage(e.currentTarget.textContent.trim());
                    wrapper.querySelector('.quick-actions').remove();
                    this.currentStep++;
                    if (this.currentStep < this.collectionSteps.length) {
                        this.addBotMessage('ì•Œê² ìŠµë‹ˆë‹¤! ğŸ‘');
                        setTimeout(() => this.askCurrentStep(), 500);
                    } else {
                        this.finishCollection();
                    }
                }
            });
        });
        const doneBtn = wrapper.querySelector('.option-done');
        if (doneBtn) {
            doneBtn.addEventListener('click', () => {
                if (!this.userProfile[step.key] || this.userProfile[step.key].length === 0) {
                    alert('ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”!');
                    return;
                }
                const selected = this.userProfile[step.key].join(', ');
                this.addUserMessage(selected);
                wrapper.querySelector('.quick-actions').remove();
                this.currentStep++;
                if (this.currentStep < this.collectionSteps.length) {
                    this.addBotMessage('ì•Œê² ìŠµë‹ˆë‹¤! ğŸ‘');
                    setTimeout(() => this.askCurrentStep(), 500);
                } else {
                    this.finishCollection();
                }
            });
        }
        this.scrollToBottom();
    }

    addUserMessage(text) {
        const wrapper = document.createElement('div');
        wrapper.className = 'message-wrapper user-message';
        wrapper.innerHTML = \`
            <div class="message-content">
                <div class="message-bubble"><p>\${text}</p></div>
                <div class="message-time">\${this.getCurrentTime()}</div>
            </div>
        \`;
        this.chatMessages.appendChild(wrapper);
        this.scrollToBottom();
    }

    addServiceCard(service) {
        const template = document.getElementById('fundCardTemplate');
        const card = template.content.cloneNode(true);
        const badge = card.querySelector('.fund-badge');
        const dday = subsidyAPI.calculateDday(service.ì‹ ì²­ê¸°í•œ);
        if (dday !== 'ìƒì‹œ' && dday !== 'ë§ˆê°') {
            badge.textContent = dday;
        } else {
            badge.textContent = 'ì§„í–‰ì¤‘';
            badge.classList.add('new');
        }
        card.querySelector('.fund-views').textContent = \`ğŸ‘ï¸ \${(service.ì¡°íšŒìˆ˜ || 0).toLocaleString()}\`;
        card.querySelector('.fund-title').textContent = service.ì„œë¹„ìŠ¤ëª…;
        card.querySelector('.fund-desc').textContent = service.ì„œë¹„ìŠ¤ëª©ì ìš”ì•½ || service.ì§€ì›ë‚´ìš© || 'ìƒì„¸ ë‚´ìš©ì€ ë§í¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
        card.querySelector('.fund-meta-item').textContent = \`ğŸ“Œ \${service.ì†Œê´€ê¸°ê´€ëª… || 'ì •ë¶€ê¸°ê´€'}\`;
        const amount = card.querySelector('.fund-amount');
        const amountMatch = (service.ì§€ì›ë‚´ìš© || '').match(/(\\d{1,3}(,\\d{3})*|\\d+)(ë§Œì›|ì–µ|ì›)/);
        if (amountMatch) amount.textContent = \`ìµœëŒ€ \${amountMatch[0]}\`;
        else amount.textContent = 'ì§€ì› ê°€ëŠ¥';
        const cta = card.querySelector('.fund-cta');
        if (service.ìƒì„¸ì¡°íšŒURL) {
            cta.href = service.ìƒì„¸ì¡°íšŒURL;
            cta.target = '_blank';
        }
        const wrapper = document.createElement('div');
        wrapper.className = 'message-wrapper bot-message';
        wrapper.innerHTML = '<div class="message-avatar">ğŸ’°</div><div class="message-content"></div>';
        wrapper.querySelector('.message-content').appendChild(card);
        this.chatMessages.appendChild(wrapper);
        this.scrollToBottom();
    }

    showTypingIndicator() {
        const template = document.getElementById('loadingTemplate');
        const loading = template.content.cloneNode(true);
        loading.querySelector('.message-wrapper').id = 'typingIndicator';
        this.chatMessages.appendChild(loading);
        this.scrollToBottom();
    }

    removeTypingIndicator() {
        const indicator = document.getElementById('typingIndicator');
        if (indicator) indicator.remove();
    }

    toggleChatbot() {
        if (this.chatContainer.style.display === 'none') {
            this.chatContainer.style.display = 'flex';
            this.floatBtn.style.display = 'none';
        } else {
            this.chatContainer.style.display = 'none';
            this.floatBtn.style.display = 'flex';
        }
    }

    scrollToBottom() {
        setTimeout(() => {
            this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
        }, 100);
    }

    getCurrentTime() {
        const now = new Date();
        return \`\${now.getHours().toString().padStart(2, '0')}:\${now.getMinutes().toString().padStart(2, '0')}\`;
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const chatbot = new SubsidyChatbot();
    console.log('âœ… ë³´ì¡°ê¸ˆ24 AI ì±—ë´‡ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!');
});`;
    </script>
</body>
</html>
